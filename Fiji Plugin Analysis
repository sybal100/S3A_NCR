from distutils.command.install_egg_info import to_filename
from encodings.utf_8 import encode
from tkinter.filedialog import SaveAs
import numpy as np
import pandas as pd
import os
import matplotlib.pyplot as plt
import seaborn as sns
import glob

plugin_dir = "/Users/filepath"

# define output folder
res_dir = f'/Users/filepath'

# create dir for output figures + data
os.makedirs(res_dir, exist_ok=True)

#samplePath = f'{plugin_dir}/{sample}'

def pluginAnalysis(sample):
    print(sample)
    os.listdir(plugin_dir) == sample
    # read the list
    samplePath = f'{plugin_dir}/{sample}'
    data = pd.read_csv(samplePath, header=None, sep="\t")

    # determine cell area
    cell_area = float((data.iloc[1,2]))/1000000

    # fenestrae number
    row_num = len(data.index)
    fen_num = row_num - 1

    # total fenestrae area
    tfen_area = (data.iloc[2:,2])
    ttfen_area = tfen_area.astype(float)
    fen_area = sum(ttfen_area)/1000000

    # average fenestrae diameter
    ffen_dia = data.iloc[2:,4].astype(float)
    fen_dia = ffen_dia.mean()

    # fenestrae frewuency 
    fen_freq = (fen_num/cell_area)

    # cell porosity
    cell_por = fen_area/cell_area

    # define file name
    file_name = (data.iloc[1,1])
    fname = file_name.split("tif").pop(0)

    # merge
    row_names = pd.DataFrame(['fenestrae frequency', 'cell porosity', 'fenestrae diameter'])
    analysis_list = pd.DataFrame([file_name,fen_freq, cell_por, fen_dia])
    final_list = analysis_list.transpose()

    #save to folder 
    final_list.to_excel(f'{res_dir}/{fname}_counts.xlsx')

    return final_list


SampleList = os.listdir(plugin_dir)
res_list = [pluginAnalysis(file) for file in SampleList]
resDf = pd.concat(res_list)
print(resDf)
resDf.to_excel(res_dir+"Total_Results.xlsx")
